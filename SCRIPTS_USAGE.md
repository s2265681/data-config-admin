# Data Config Admin - è„šæœ¬ä½¿ç”¨æ–‡æ¡£

## ğŸ“‹ æ¦‚è¿°

Data Config Admin æ˜¯ä¸€ä¸ªåŸºäºæ–‡ä»¶å¤¹çš„é…ç½®æ–‡ä»¶ç®¡ç†ç³»ç»Ÿï¼Œæ”¯æŒåœ¨ AWS S3 å’Œæœ¬åœ°æ–‡ä»¶å¤¹ä¹‹é—´è¿›è¡ŒåŒå‘åŒæ­¥ã€‚æœ¬æ–‡æ¡£ä»‹ç»æ‰€æœ‰å¯ç”¨çš„è„šæœ¬å‘½ä»¤åŠå…¶ä½¿ç”¨æ–¹æ³•ã€‚

## ğŸš€ æ ¸å¿ƒå‘½ä»¤

### éƒ¨ç½²ç›¸å…³

#### `npm run deploy`
- **åŠŸèƒ½**: æ ‡å‡† Serverless éƒ¨ç½²
- **ç”¨é€”**: éƒ¨ç½²æ•´ä¸ªé¡¹ç›®åˆ° AWS
- **ç¤ºä¾‹**: 
  ```bash
  npm run deploy
  ```

#### `npm run deploy-with-validation`
- **åŠŸèƒ½**: å¸¦é…ç½®éªŒè¯çš„éƒ¨ç½²
- **ç”¨é€”**: éƒ¨ç½²å‰éªŒè¯æ–‡ä»¶å¤¹é…ç½®ï¼Œç¡®ä¿é…ç½®æ­£ç¡®
- **ç¤ºä¾‹**: 
  ```bash
  npm run deploy-with-validation
  ```

#### `npm run update-lambda [function-name]`
- **åŠŸèƒ½**: å¿«é€Ÿæ›´æ–° Lambda å‡½æ•°
- **å‚æ•°**: 
  - `function-name` (å¯é€‰): è¦æ›´æ–°çš„å‡½æ•°åç§°ï¼Œé»˜è®¤ä¸º `s3ToGithubSync`
- **ç”¨é€”**: åªæ›´æ–°å‡½æ•°ä»£ç ï¼Œä¸æ›´æ–°äº‹ä»¶é…ç½®
- **ç¤ºä¾‹**: 
  ```bash
  npm run update-lambda
  npm run update-lambda s3ToGithubSync
  ```

### åŒæ­¥ç›¸å…³

#### `npm run sync-to-s3`
- **åŠŸèƒ½**: å°†æœ¬åœ°æ–‡ä»¶å¤¹åŒæ­¥åˆ° S3
- **ç”¨é€”**: å°† `configuration/` ç›®å½•ä¸‹çš„æ–‡ä»¶æŒ‰æ–‡ä»¶å¤¹ç»“æ„åŒæ­¥åˆ° S3
- **ç‰¹ç‚¹**: 
  - æ™ºèƒ½åŒæ­¥ï¼ˆåªåŒæ­¥å˜æ›´çš„æ–‡ä»¶ï¼‰
  - åŸºäºæ–‡ä»¶å“ˆå¸Œæ¯”è¾ƒ
  - æ”¯æŒå¤šç¯å¢ƒï¼ˆstaging/productionï¼‰
- **ç¤ºä¾‹**: 
  ```bash
  npm run sync-to-s3
  ```

#### `npm run sync-from-s3`
- **åŠŸèƒ½**: ä» S3 åŒæ­¥åˆ°æœ¬åœ°æ–‡ä»¶å¤¹
- **ç”¨é€”**: å°† S3 ä¸­çš„æ–‡ä»¶åŒæ­¥å›æœ¬åœ° `configuration/` ç›®å½•
- **ç‰¹ç‚¹**: 
  - ä¿æŒæ–‡ä»¶å¤¹ç»“æ„
  - è¦†ç›–æœ¬åœ°æ–‡ä»¶
  - è¯¦ç»†æ—¥å¿—è¾“å‡º
- **ç¤ºä¾‹**: 
  ```bash
  npm run sync-from-s3
  ```

### ç›‘æ§ç›¸å…³

#### `npm run monitor`
- **åŠŸèƒ½**: ç›‘æ§æ–‡ä»¶å¤¹åŒæ­¥çŠ¶æ€
- **ç”¨é€”**: æ£€æŸ¥æœ¬åœ°æ–‡ä»¶å¤¹å’Œ S3 çš„åŒæ­¥çŠ¶æ€
- **è¾“å‡º**: 
  - æ–‡ä»¶å­˜åœ¨æ€§æ£€æŸ¥
  - æ–‡ä»¶å¤§å°æ¯”è¾ƒ
  - æœ€åä¿®æ”¹æ—¶é—´
  - åŒæ­¥çŠ¶æ€åˆ†æ
- **ç¤ºä¾‹**: 
  ```bash
  npm run monitor
  ```

### ç®¡ç†ç›¸å…³

#### `npm run manage-folders`
- **åŠŸèƒ½**: æ–‡ä»¶å¤¹ç®¡ç†å·¥å…·
- **ç”¨é€”**: ç®¡ç† `config/folders.json` é…ç½®
- **åŠŸèƒ½**: 
  - åˆ—å‡ºæ‰€æœ‰æ–‡ä»¶å¤¹
  - éªŒè¯é…ç½®
  - æ·»åŠ /åˆ é™¤æ–‡ä»¶å¤¹
  - æ·»åŠ /åˆ é™¤æ–‡ä»¶
- **ç¤ºä¾‹**: 
  ```bash
  npm run manage-folders
  npm run manage-folders list
  npm run manage-folders validate
  npm run manage-folders add-folder
  npm run manage-folders add-file
  ```

#### `npm run migrate`
- **åŠŸèƒ½**: è¿ç§»åˆ°æ–‡ä»¶å¤¹ç»“æ„
- **ç”¨é€”**: ä»æ—§çš„å•æ–‡ä»¶é…ç½®è¿ç§»åˆ°æ–°çš„æ–‡ä»¶å¤¹ç»“æ„
- **æ³¨æ„**: ä»…ç”¨äºä¸€æ¬¡æ€§è¿ç§»ï¼Œæ—¥å¸¸ä½¿ç”¨ä¸éœ€è¦
- **ç¤ºä¾‹**: 
  ```bash
  npm run migrate
  ```

## ğŸ“ æ–‡ä»¶å¤¹ç»“æ„

```
configuration/
â”œâ”€â”€ config/          # é…ç½®æ–‡ä»¶å¤¹1
â”‚   â”œâ”€â”€ test.json
â”‚   â””â”€â”€ ...
â”œâ”€â”€ config2/         # é…ç½®æ–‡ä»¶å¤¹2
â”‚   â”œâ”€â”€ test2.json
â”‚   â”œâ”€â”€ test3.json
â”‚   â””â”€â”€ ...
â””â”€â”€ config3/         # é…ç½®æ–‡ä»¶å¤¹3
    â”œâ”€â”€ test4.json
    â””â”€â”€ ...
```

## âš™ï¸ é…ç½®æ–‡ä»¶

### `config/folders.json`
å®šä¹‰æ–‡ä»¶å¤¹æ˜ å°„å…³ç³»ï¼š

```json
{
  "folders": [
    {
      "name": "config",
      "description": "ä¸»è¦é…ç½®æ–‡ä»¶",
      "local_path": "configuration/config",
      "s3_prefix": "config/staging",
      "files": [
        {
          "name": "test.json",
          "description": "æµ‹è¯•é…ç½®æ–‡ä»¶"
        }
      ]
    }
  ]
}
```

## ğŸ”„ å·¥ä½œæµç¨‹

### 1. åˆå§‹è®¾ç½®
```bash
# 1. éªŒè¯é…ç½®
npm run manage-folders validate

# 2. éƒ¨ç½²åˆ° AWS
npm run deploy-with-validation
```

### 2. æ—¥å¸¸åŒæ­¥
```bash
# 1. æœ¬åœ°ä¿®æ”¹æ–‡ä»¶åï¼ŒåŒæ­¥åˆ° S3
npm run sync-to-s3

# 2. ç›‘æ§åŒæ­¥çŠ¶æ€
npm run monitor

# 3. å¦‚æœéœ€è¦ä» S3 åŒæ­¥å›æœ¬åœ°
npm run sync-from-s3
```

### 3. æ·»åŠ æ–°æ–‡ä»¶
```bash
# 1. ä½¿ç”¨ç®¡ç†å·¥å…·æ·»åŠ æ–‡ä»¶
npm run manage-folders add-file

# 2. åŒæ­¥åˆ° S3
npm run sync-to-s3
```

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **åŒæ­¥å¤±è´¥**
   ```bash
   # æ£€æŸ¥ AWS å‡­è¯
   aws sts get-caller-identity
   
   # æ£€æŸ¥ç¯å¢ƒå˜é‡
   echo $AWS_REGION
   echo $S3_BUCKET
   ```

2. **é…ç½®éªŒè¯å¤±è´¥**
   ```bash
   # éªŒè¯é…ç½®
   npm run manage-folders validate
   ```

3. **Lambda å‡½æ•°é—®é¢˜**
   ```bash
   # æŸ¥çœ‹æ—¥å¿—
   serverless logs -f s3ToGithubSync --tail
   
   # æ›´æ–°å‡½æ•°
   npm run update-lambda
   ```

### æ—¥å¿—æŸ¥çœ‹

```bash
# æŸ¥çœ‹ Lambda æ—¥å¿—
serverless logs -f s3ToGithubSync --tail

# æŸ¥çœ‹éƒ¨ç½²æ—¥å¿—
serverless deploy --verbose
```

## ğŸ“Š ç›‘æ§å’ŒçŠ¶æ€

### åŒæ­¥çŠ¶æ€æ£€æŸ¥
```bash
npm run monitor
```

è¾“å‡ºç¤ºä¾‹ï¼š
```
ğŸ“Š åŒæ­¥çŠ¶æ€åˆ†æ
================
âœ… æˆåŠŸ: 3 ä¸ªæ–‡ä»¶
âŒ å¤±è´¥: 0 ä¸ªæ–‡ä»¶
â­ï¸  è·³è¿‡: 1 ä¸ªæ–‡ä»¶

âœ… æˆåŠŸåŒæ­¥çš„æ–‡ä»¶:
   ğŸ“„ test.json â†’ config/staging/test.json (æ–°å¢)
   ğŸ“„ test2.json â†’ config/staging/test2.json (å˜æ›´)
```

## ğŸ”§ é«˜çº§ç”¨æ³•

### ç¯å¢ƒå˜é‡é…ç½®

```bash
# AWS é…ç½®
export AWS_REGION=ap-southeast-2
export S3_BUCKET=your-bucket-name

# GitHub é…ç½®ï¼ˆå¦‚æœéœ€è¦ï¼‰
export GITHUB_TOKEN=your-github-token
export GITHUB_REPO=owner/repo
```

### è‡ªå®šä¹‰åŒæ­¥

å¯ä»¥é€šè¿‡ä¿®æ”¹ `config/folders.json` æ¥è‡ªå®šä¹‰ï¼š
- æ–‡ä»¶å¤¹æ˜ å°„å…³ç³»
- S3 å‰ç¼€è·¯å¾„
- æ–‡ä»¶æè¿°ä¿¡æ¯

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **å¤‡ä»½é‡è¦æ–‡ä»¶**: åŒæ­¥æ“ä½œä¼šè¦†ç›–ç›®æ ‡æ–‡ä»¶ï¼Œè¯·ç¡®ä¿é‡è¦æ•°æ®å·²å¤‡ä»½
2. **æƒé™æ£€æŸ¥**: ç¡®ä¿ AWS å‡­è¯æœ‰è¶³å¤Ÿçš„ S3 è¯»å†™æƒé™
3. **ç½‘ç»œè¿æ¥**: ç¡®ä¿ç½‘ç»œè¿æ¥ç¨³å®šï¼Œé¿å…åŒæ­¥ä¸­æ–­
4. **é…ç½®éªŒè¯**: ä¿®æ”¹é…ç½®ååŠ¡å¿…è¿è¡ŒéªŒè¯å‘½ä»¤

## ğŸ†˜ è·å–å¸®åŠ©

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œå¯ä»¥ï¼š

1. æŸ¥çœ‹è¯¦ç»†æ—¥å¿—è¾“å‡º
2. è¿è¡Œé…ç½®éªŒè¯å‘½ä»¤
3. æ£€æŸ¥ AWS å‡­è¯å’Œæƒé™
4. æŸ¥çœ‹ Lambda å‡½æ•°æ—¥å¿—

---

*æœ€åæ›´æ–°: 2024å¹´* 