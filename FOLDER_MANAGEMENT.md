# æ–‡ä»¶å¤¹ç®¡ç†åŠŸèƒ½ä½¿ç”¨æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

ä¸ºäº†è§£å†³é…ç½®æ–‡ä»¶è¿‡å¤šæ—¶ç®¡ç†å›°éš¾çš„é—®é¢˜ï¼Œæˆ‘ä»¬å¼•å…¥äº†åŸºäºæ–‡ä»¶å¤¹çš„é…ç½®ç®¡ç†åŠŸèƒ½ã€‚è¿™ä¸ªåŠŸèƒ½å…è®¸æ‚¨é€šè¿‡é…ç½®å£°æ˜æ¥ç®¡ç†ä¸åŒæ–‡ä»¶å¤¹ï¼Œè®©æœ¬åœ°æ–‡ä»¶å¤¹ç»“æ„ä¸S3ç›®å½•ç»“æ„ä¿æŒä¸€è‡´ã€‚

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### æ–°çš„æ–‡ä»¶å¤¹ç»“æ„
```
app-config/
â”œâ”€â”€ config/              # ä¸»è¦é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ test.json
â”œâ”€â”€ config2/             # æ¬¡è¦é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ test2.json
â”‚   â””â”€â”€ test3.json
â””â”€â”€ config3/             # ç¬¬ä¸‰æ–¹é…ç½®æ–‡ä»¶
    â””â”€â”€ test4.json
```

### S3ç›®å½•ç»“æ„
```
s3://bucket/
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ staging/
â”‚   â”‚   â””â”€â”€ test.json
â”‚   â””â”€â”€ production/
â”‚       â””â”€â”€ test.json
â”œâ”€â”€ config2/
â”‚   â”œâ”€â”€ staging/
â”‚   â”‚   â”œâ”€â”€ test2.json
â”‚   â”‚   â””â”€â”€ test3.json
â”‚   â””â”€â”€ production/
â”‚       â”œâ”€â”€ test2.json
â”‚       â””â”€â”€ test3.json
â””â”€â”€ config3/
    â”œâ”€â”€ staging/
    â”‚   â””â”€â”€ test4.json
    â””â”€â”€ production/
        â””â”€â”€ test4.json
```

## ğŸ“ é…ç½®æ–‡ä»¶

### `config/folders.json` - æ–‡ä»¶å¤¹é…ç½®
```json
{
  "folders": [
    {
      "name": "config",
      "description": "ä¸»è¦é…ç½®æ–‡ä»¶",
      "local_path": "app-config/config",
      "s3_prefix_staging": "config/staging",
      "s3_prefix_production": "config/production",
      "files": [
        {
          "name": "test.json",
          "description": "ä¸»è¦é…ç½®æ–‡ä»¶"
        }
      ]
    },
    {
      "name": "config3",
      "description": "ç¬¬ä¸‰æ–¹é…ç½®æ–‡ä»¶", 
      "local_path": "app-config/config3",
      "s3_prefix_staging": "config3/staging",
      "files": [
        {
          "name": "test4.json",
          "description": "ç¬¬å››ä¸ªé…ç½®æ–‡ä»¶"
        }
      ]
    }
  ],
  "environments": {
    "staging": {
      "github_branch": "staging"
    },
    "production": {
      "github_branch": "main"
    }
  }
}
```

### ğŸ” ç›‘æ§é…ç½®è¯´æ˜

Lambda å‡½æ•°ä¼šæ ¹æ® `config/folders.json` ä¸­çš„é…ç½®æ¥å†³å®šç›‘æ§å“ªäº›è·¯å¾„ï¼š

1. **ç¯å¢ƒç›‘æ§æ§åˆ¶**ï¼š
   - å¦‚æœé…ç½®äº† `s3_prefix_staging`ï¼Œåˆ™ç›‘æ§ staging ç¯å¢ƒ
   - å¦‚æœé…ç½®äº† `s3_prefix_production`ï¼Œåˆ™ç›‘æ§ production ç¯å¢ƒ
   - å¦‚æœæŸä¸ªç¯å¢ƒæ²¡æœ‰é…ç½®å‰ç¼€ï¼Œåˆ™ä¸ä¼šç›‘æ§è¯¥ç¯å¢ƒ

2. **ç¤ºä¾‹**ï¼š
   - `config` æ–‡ä»¶å¤¹ï¼šé…ç½®äº† staging å’Œ productionï¼Œä¸¤ä¸ªç¯å¢ƒéƒ½ä¼šè¢«ç›‘æ§
   - `config3` æ–‡ä»¶å¤¹ï¼šåªé…ç½®äº† stagingï¼Œåªæœ‰ staging ç¯å¢ƒä¼šè¢«ç›‘æ§ï¼Œproduction ç¯å¢ƒä¼šè¢«è·³è¿‡

3. **ç›‘æ§é€»è¾‘**ï¼š
   - åªæœ‰ JSON æ–‡ä»¶ä¼šè¢«ç›‘æ§
   - æ–‡ä»¶å¿…é¡»åœ¨å¯¹åº”æ–‡ä»¶å¤¹çš„ `files` é…ç½®ä¸­
   - è·¯å¾„å¿…é¡»åŒ¹é…é…ç½®çš„å‰ç¼€æ ¼å¼

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. è¿ç§»ç°æœ‰é…ç½®
```bash
# è¿è¡Œè¿ç§»è„šæœ¬
npm run migrate-to-folders
```

è¿™ä¸ªè„šæœ¬ä¼šï¼š
- éªŒè¯æ–‡ä»¶å¤¹é…ç½®
- åˆ›å»ºæ–°çš„æ–‡ä»¶å¤¹ç»“æ„
- è¿ç§»ç°æœ‰æ–‡ä»¶åˆ°æ–°ç»“æ„
- å¤‡ä»½æ—§çš„é…ç½®æ–‡ä»¶
- ç”Ÿæˆå…¼å®¹æ€§é…ç½®

### 2. éªŒè¯è¿ç§»ç»“æœ
```bash
# ç”Ÿæˆæ–‡ä»¶å¤¹ç»“æ„æŠ¥å‘Š
npm run manage-folders report
```

### 3. ä½¿ç”¨æ–°çš„åŒæ­¥åŠŸèƒ½
```bash
# åŸºäºæ–‡ä»¶å¤¹çš„åŒæ­¥
npm run sync-folders-to-s3
```

## ğŸ“‹ ç®¡ç†å‘½ä»¤

### æ–‡ä»¶å¤¹ç®¡ç†å·¥å…·
```bash
# æŸ¥çœ‹å¸®åŠ©
npm run manage-folders

# ç”ŸæˆæŠ¥å‘Š
npm run manage-folders report

# åˆ›å»ºæ–‡ä»¶å¤¹ç»“æ„
npm run manage-folders create-structure

# è¿ç§»æ–‡ä»¶
npm run manage-folders migrate

# éªŒè¯é…ç½®
npm run manage-folders validate

# åˆ—å‡ºæ‰€æœ‰æ–‡ä»¶å¤¹
npm run manage-folders list

# åˆ—å‡ºæŒ‡å®šæ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶
npm run manage-folders list-files config
```

### æ·»åŠ æ–°æ–‡ä»¶å¤¹
```bash
# æ·»åŠ æ–°æ–‡ä»¶å¤¹
npm run manage-folders add-folder "database" "æ•°æ®åº“é…ç½®" "db-config"
```

### æ·»åŠ æ–°æ–‡ä»¶
```bash
# æ·»åŠ æ–°æ–‡ä»¶åˆ°æŒ‡å®šæ–‡ä»¶å¤¹
npm run manage-folders add-file "database" "mysql.json" "MySQLæ•°æ®åº“é…ç½®"
```

## ğŸ”§ æ ¸å¿ƒåŠŸèƒ½

### 1. æ–‡ä»¶å¤¹ç®¡ç†å™¨ (`utils/folder-manager.js`)
- **é…ç½®åŠ è½½**: åŠ è½½å’Œç®¡ç†æ–‡ä»¶å¤¹é…ç½®
- **æ–‡ä»¶æ“ä½œ**: è¯»å–ã€å†™å…¥ã€éªŒè¯æ–‡ä»¶
- **å“ˆå¸Œè®¡ç®—**: è®¡ç®—æ–‡ä»¶å“ˆå¸Œå€¼ç”¨äºå˜æ›´æ£€æµ‹
- **ç»“æ„ç®¡ç†**: åˆ›å»ºå’Œç®¡ç†æ–‡ä»¶å¤¹ç»“æ„
- **è¿ç§»æ”¯æŒ**: æ”¯æŒä»æ—§ç»“æ„è¿ç§»åˆ°æ–°ç»“æ„

### 2. æ™ºèƒ½åŒæ­¥ (`scripts/sync-folders-to-s3.js`)
- **æ–‡ä»¶å¤¹éå†**: æŒ‰æ–‡ä»¶å¤¹ç»„ç»‡åŒæ­¥æ–‡ä»¶
- **å˜æ›´æ£€æµ‹**: åªåŒæ­¥å‘ç”Ÿå˜åŒ–çš„æ–‡ä»¶
- **è¯¦ç»†æ—¥å¿—**: æä¾›è¯¦ç»†çš„åŒæ­¥æ—¥å¿—
- **é”™è¯¯å¤„ç†**: å®Œå–„çš„é”™è¯¯å¤„ç†æœºåˆ¶

### 3. è¿ç§»å·¥å…· (`scripts/migrate-to-folders.js`)
- **è‡ªåŠ¨è¿ç§»**: è‡ªåŠ¨è¿ç§»ç°æœ‰æ–‡ä»¶åˆ°æ–°ç»“æ„
- **é…ç½®éªŒè¯**: éªŒè¯è¿ç§»åçš„é…ç½®
- **å¤‡ä»½æœºåˆ¶**: è‡ªåŠ¨å¤‡ä»½æ—§é…ç½®
- **å…¼å®¹æ€§**: ç”Ÿæˆå…¼å®¹æ€§é…ç½®æ–‡ä»¶

## ğŸ“Š ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1: æ·»åŠ æ•°æ®åº“é…ç½®æ–‡ä»¶å¤¹
```bash
# 1. æ·»åŠ æ•°æ®åº“é…ç½®æ–‡ä»¶å¤¹
npm run manage-folders add-folder "database" "æ•°æ®åº“é…ç½®" "db-config"

# 2. æ·»åŠ MySQLé…ç½®æ–‡ä»¶
npm run manage-folders add-file "database" "mysql.json" "MySQLæ•°æ®åº“é…ç½®"

# 3. æ·»åŠ PostgreSQLé…ç½®æ–‡ä»¶
npm run manage-folders add-file "database" "postgresql.json" "PostgreSQLæ•°æ®åº“é…ç½®"

# 4. åŒæ­¥åˆ°S3
npm run sync-folders-to-s3
```

### ç¤ºä¾‹2: æ·»åŠ APIé…ç½®æ–‡ä»¶å¤¹
```bash
# 1. æ·»åŠ APIé…ç½®æ–‡ä»¶å¤¹
npm run manage-folders add-folder "api" "APIé…ç½®" "api-config"

# 2. æ·»åŠ ç”¨æˆ·æœåŠ¡é…ç½®
npm run manage-folders add-file "api" "user-service.json" "ç”¨æˆ·æœåŠ¡é…ç½®"

# 3. æ·»åŠ è®¢å•æœåŠ¡é…ç½®
npm run manage-folders add-file "api" "order-service.json" "è®¢å•æœåŠ¡é…ç½®"

# 4. åŒæ­¥åˆ°S3
npm run sync-folders-to-s3
```

## ğŸ” ç›‘æ§å’ŒæŠ¥å‘Š

### ç”Ÿæˆæ–‡ä»¶å¤¹æŠ¥å‘Š
```bash
npm run manage-folders report
```

è¾“å‡ºç¤ºä¾‹ï¼š
```
ğŸ“Š æ–‡ä»¶å¤¹ç»“æ„æŠ¥å‘Š:
==================

ğŸ“ config (ä¸»è¦é…ç½®æ–‡ä»¶)
   æœ¬åœ°è·¯å¾„: app-config/config
   S3å‰ç¼€: config
   æ–‡ä»¶æ•°é‡: 1
   æ–‡ä»¶åˆ—è¡¨:
     âœ… test.json - ä¸»è¦é…ç½®æ–‡ä»¶

ğŸ“ config2 (æ¬¡è¦é…ç½®æ–‡ä»¶)
   æœ¬åœ°è·¯å¾„: app-config/config2
   S3å‰ç¼€: config2
   æ–‡ä»¶æ•°é‡: 2
   æ–‡ä»¶åˆ—è¡¨:
     âœ… test2.json - ç¬¬äºŒä¸ªé…ç½®æ–‡ä»¶
     âœ… test3.json - ç¬¬ä¸‰ä¸ªé…ç½®æ–‡ä»¶

âœ… é…ç½®éªŒè¯é€šè¿‡
```

### åˆ—å‡ºæ–‡ä»¶å¤¹å†…å®¹
```bash
npm run manage-folders list-files config
```

è¾“å‡ºç¤ºä¾‹ï¼š
```
ğŸ“„ æ–‡ä»¶å¤¹ config ä¸­çš„æ–‡ä»¶:
========================
   âœ… test.json - ä¸»è¦é…ç½®æ–‡ä»¶
```

## ğŸ›¡ï¸ å®‰å…¨ç‰¹æ€§

### 1. é…ç½®éªŒè¯
- æ£€æŸ¥æ–‡ä»¶å¤¹åç§°å”¯ä¸€æ€§
- æ£€æŸ¥S3å‰ç¼€å”¯ä¸€æ€§
- æ£€æŸ¥æ–‡ä»¶åç§°å”¯ä¸€æ€§
- éªŒè¯JSONæ ¼å¼

### 2. å¤‡ä»½æœºåˆ¶
- è‡ªåŠ¨å¤‡ä»½æ—§é…ç½®æ–‡ä»¶
- ç”Ÿæˆå…¼å®¹æ€§é…ç½®æ–‡ä»¶
- æ”¯æŒå›æ»šæ“ä½œ

### 3. é”™è¯¯å¤„ç†
- è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
- ä¼˜é›…çš„é”™è¯¯å¤„ç†
- æ“ä½œæ—¥å¿—è®°å½•

## ï¿½ï¿½ è¿ç§»æµç¨‹

### è¿ç§»å‰
```
app-config/
â”œâ”€â”€ test.json
â”œâ”€â”€ test2.json
â”œâ”€â”€ test3.json
â””â”€â”€ test4.json
```

### è¿ç§»å
```
app-config/
â”œâ”€â”€ config/
â”‚   â””â”€â”€ test.json
â”œâ”€â”€ config2/
â”‚   â”œâ”€â”€ test2.json
â”‚   â””â”€â”€ test3.json
â””â”€â”€ config3/
    â””â”€â”€ test4.json
```

### è¿ç§»æ­¥éª¤
1. **å¤‡ä»½**: è‡ªåŠ¨å¤‡ä»½ç°æœ‰é…ç½®
2. **éªŒè¯**: éªŒè¯æ–°çš„æ–‡ä»¶å¤¹é…ç½®
3. **åˆ›å»º**: åˆ›å»ºæ–°çš„æ–‡ä»¶å¤¹ç»“æ„
4. **è¿ç§»**: ç§»åŠ¨æ–‡ä»¶åˆ°æ–°ä½ç½®
5. **éªŒè¯**: éªŒè¯è¿ç§»ç»“æœ
6. **æŠ¥å‘Š**: ç”Ÿæˆè¿ç§»æŠ¥å‘Š

## ğŸ“ˆ ä¼˜åŠ¿

### 1. ç»„ç»‡ç»“æ„æ¸…æ™°
- æŒ‰åŠŸèƒ½åˆ†ç±»ç®¡ç†é…ç½®æ–‡ä»¶
- æœ¬åœ°ç»“æ„ä¸S3ç»“æ„ä¿æŒä¸€è‡´
- ä¾¿äºç†è§£å’Œç»´æŠ¤

### 2. æ‰©å±•æ€§å¼º
- æ”¯æŒåŠ¨æ€æ·»åŠ æ–‡ä»¶å¤¹
- æ”¯æŒåŠ¨æ€æ·»åŠ æ–‡ä»¶
- é…ç½®é©±åŠ¨çš„ç®¡ç†æ–¹å¼

### 3. æ“ä½œç®€ä¾¿
- å‘½ä»¤è¡Œå·¥å…·æ”¯æŒ
- è‡ªåŠ¨åŒ–è¿ç§»æµç¨‹
- è¯¦ç»†çš„å¸®åŠ©ä¿¡æ¯

### 4. å…¼å®¹æ€§å¥½
- ä¿æŒä¸ç°æœ‰ç³»ç»Ÿçš„å…¼å®¹æ€§
- æ”¯æŒæ¸è¿›å¼è¿ç§»
- å‘åå…¼å®¹çš„API

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. æ–‡ä»¶å¤¹é…ç½®éªŒè¯å¤±è´¥
```bash
# æ£€æŸ¥é…ç½®
npm run manage-folders validate
```

#### 2. æ–‡ä»¶è¿ç§»å¤±è´¥
```bash
# é‡æ–°åˆ›å»ºæ–‡ä»¶å¤¹ç»“æ„
npm run manage-folders create-structure

# é‡æ–°è¿ç§»æ–‡ä»¶
npm run manage-folders migrate
```

#### 3. åŒæ­¥å¤±è´¥
```bash
# æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
npm run manage-folders list-files <folder-name>

# éªŒè¯é…ç½®
npm run manage-folders validate
```

## ğŸ“š ç›¸å…³æ–‡ä»¶

- `config/folders.json` - æ–‡ä»¶å¤¹é…ç½®
- `utils/folder-manager.js` - æ–‡ä»¶å¤¹ç®¡ç†å™¨
- `scripts/migrate-to-folders.js` - è¿ç§»è„šæœ¬
- `scripts/sync-folders-to-s3.js` - åŒæ­¥è„šæœ¬
- `scripts/manage-folders.js` - ç®¡ç†å·¥å…·

è¿™ä¸ªæ–‡ä»¶å¤¹ç®¡ç†åŠŸèƒ½ä¸ºæ‚¨çš„é…ç½®æ–‡ä»¶ç®¡ç†æä¾›äº†æ›´å¥½çš„ç»„ç»‡ç»“æ„ï¼Œè®©æ‚¨å¯ä»¥æ›´è½»æ¾åœ°ç®¡ç†å¤§é‡çš„é…ç½®æ–‡ä»¶ã€‚ 